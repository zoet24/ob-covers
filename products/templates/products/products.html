{% extends "base.html" %}
{% load static %}

{% block content %}

{% include 'products/includes/product_nav_header.html' %}

<!-- Filter and sort modals -->
<section class="container-fluid bg-lightblue d-md-none">
    <div class="row pt-3 pb-0">
        <div class="col-12">
            <div class="btn btn-light btn-sm mr-2 mr-sm-4" onclick="openFilters()">Filter <i class="fas fa-sliders-h"></i></div>
            <div class="btn btn-light btn-sm ml-2 ml-sm-4" onclick="openSort()">Sort <i class="fas fa-sort"></i></div>
        </div>
    </div>
    <!-- Filters modal -->
    <div class="modal-filters hide" id="modal-filters">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body pt-0">
                    <button class="icon icon-black modal-close" onclick="closeFilters()">
                        <span><i class="fas fa-times"></i></span>
                    </button>
                    {% include 'products/includes/product_filter_categories.html' %}
                </div>
            </div>
        </div>
    </div>
    <!-- Sort modal -->
    <div class="modal-filters hide" id="modal-sort">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-body pt-0">
                    <button class="icon icon-black modal-close" onclick="closeSort()">
                        <span><i class="fas fa-times"></i></span>
                    </button>
                    {% include 'products/includes/product_sort_categories.html' %}
                </div>
            </div>
        </div>
    </div>
</section>
<section class="container-fluid bg-lightblue">
    <div class="row py-0 mb-0">
        <div class="d-none d-md-block px-0 col-md-4 ml-md-auto col-lg-3 col-xl-2">
            <div class="sticky-top">
            {% include 'products/includes/product_filter_categories.html' %}
            {% include 'products/includes/product_sort_categories.html' %}
            </div>
        </div>
        {% if products %}
            <div class="col-12 col-md-7 px-md-0 col-lg-8 col-xl-9">
                <div class="row justify-content-center">
                    {% for product in products %}
                        {% include 'products/includes/product_covertiles.html' %}
                    {% endfor %}
                </div>
            </div>
        {% else %}
            <div class="col-11 col-sm-7 mx-auto no-search-results-container">
                <div class="no-search-results">
                    <hr class="mt-4 mb-2">
                    <h2>No results!</h2>
                    <span class="text-md text-skinny">Sorry about that! Try changing your search terms and give it another go!</span>
                    <hr class="mt-2 mb-4">
                </div>
            </div>
        {% endif %}
    </div>
    <div class="icon icon-black btn-up hide">
        <a class="btn-up-link">
            <i class="fas fa-arrow-up"></i>
        </a>
    </div>
</section>
{% endblock %}

{% block postloadjs %}
{{ block.super }}
<script type="text/javascript">
    onload = function() {
        var currentUrl = new URL(window.location);
        var range = currentUrl.searchParams.get("range");
        var style = currentUrl.searchParams.get("style");
        var colour = currentUrl.searchParams.get("colour");
        var other = currentUrl.searchParams.get("other");
        var sort = currentUrl.searchParams.get("sort");
        var direction = currentUrl.searchParams.get("direction");

        if (range !== null) {
            var category = "range";
            var name = range;
        } else if (style !== null) {
            var category = "style";
            var name = style;
        } else if (colour !== null) {
            var category = "colour";
            var name = colour;
        } else if (other !== null) {
            $(`input[name=other][value='${other}']`).prop("checked",true);
            $(`#collapse-productfilters-other`).addClass("show");
            var category = null;
        } else {
            var category = null;
            var name = null;
        }

        if (category !== null) {
            var filtersTitleNav = $(`#${name}_label`).text().trim()
            $("#filters-title-nav").html(filtersTitleNav);

            var filtersTitle = $(`#${name}_label`).text().trim().split("(")[0].trim();
            $(`input[name=${category}][value='${name}']`).prop("checked",true);
            $(`#collapse-productfilters-${category}`).addClass("show");
            $(".filters-title").html(`${filtersTitle}`);
        }

        var sortTitle = $(`#${sort}_${direction}_label`).text().trim();
        $(".sort-title").html(sortTitle);
        $(`input[name="sort"][value='${sort}_${direction}']`).prop("checked",true);
    }
</script>

<script type="text/javascript">
    function openFilters() {
        $("#modal-filters").removeClass("hide");
    }

    function closeFilters() {
        $("#modal-filters").addClass("hide");
    }

    function openSort() {
        $("#modal-sort").removeClass("hide");
    }

    function closeSort() {
        $("#modal-sort").addClass("hide");
    }
</script>
{% endblock %}